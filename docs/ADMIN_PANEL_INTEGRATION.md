# Интеграция админ-панели

## Обзор

Этот документ описывает интеграцию фронтенда админ-панели с бэкенд API. Все функции администратора теперь используют реальные API вызовы вместо моковых данных.

## Архитектура

### Сервисный слой
Все API вызовы инкапсулированы в `adminService`, который использует `httpClient` для взаимодействия с бэкендом.

### Аутентификация
API вызовы автоматически включают JWT токен в заголовки запросов через interceptor в `httpClient`.

## Эндпоинты API

### Дашборд
- `GET /api/admin/dashboard/stats` - Получение статистики админ-панели
- `GET /api/admin/dashboard/students-ending-soon` - Получение списка студентов с заканчивающимися пакетами

### Управление менеджерами
- `GET /api/admin/managers` - Получение списка всех менеджеров
- `POST /api/admin/managers` - Создание нового менеджера
- `PUT /api/admin/managers/{id}` - Обновление менеджера
- `DELETE /api/admin/managers/{id}` - Удаление менеджера
- `POST /api/admin/managers/{id}/reset-password` - Сброс пароля менеджера

### Управление преподавателями
- `GET /api/admin/teachers` - Получение списка всех преподавателей
- `POST /api/admin/teachers` - Создание нового преподавателя
- `PUT /api/admin/teachers/{id}` - Обновление преподавателя
- `DELETE /api/admin/teachers/{id}` - Удаление преподавателя
- `POST /api/admin/teachers/{id}/reset-password` - Сброс пароля преподавателя

### Управление студентами
- `GET /api/admin/students` - Получение списка всех студентов
- `POST /api/admin/students` - Создание нового студента
- `PUT /api/admin/students/{id}` - Обновление студента
- `DELETE /api/admin/students/{id}` - Удаление студента
- `POST /api/admin/students/{id}/reset-password` - Сброс пароля студента

### Отчеты
- `GET /api/admin/reports/students` - Генерация отчета по студентам
- `GET /api/admin/reports/teachers` - Генерация отчета по преподавателям
- `GET /api/admin/reports/lessons` - Генерация отчета по урокам

## Обработка ошибок

Все API вызовы включают обработку ошибок:
- Логирование ошибок через `logError`
- Пробрасывание ошибок для отображения в UI
- Обработка специфичных HTTP кодов ошибок (например, 401 для перенаправления на логин)

## Валидация данных

Валидация данных происходит на нескольких уровнях:
1. На фронтенде - проверка форм перед отправкой
2. На бэкенде - валидация DTO через аннотации Jakarta Validation
3. На уровне базы данных - ограничения целостности

## Тестирование

### Функциональное тестирование
- Проверка загрузки данных для всех разделов админ-панели
- Проверка создания/обновления/удаления сущностей
- Проверка генерации отчетов

### Обработка ошибок
- Проверка отображения ошибок при недоступности API
- Проверка обработки невалидных данных
- Проверка поведения при истечении срока действия токена

## Развертывание

### Переменные окружения
- `VITE_API_BASE_URL` - Базовый URL для API вызовов (по умолчанию '/api')

### CORS
Настроен CORS на бэкенде для разрешения запросов с фронтенда.

## Примеры использования

### Загрузка статистики дашборда
```typescript
const dashboardStats = await adminService.getDashboardStats();
```

### Создание менеджера
```typescript
await adminService.createManager({
  firstName: 'Иван',
  lastName: 'Иванов',
  email: 'ivan.ivanov@example.com',
  phone: '+79123456789',
  telegramUsername: 'ivan_ivanov',
  isActive: true
});
```

### Генерация отчета
```typescript
const reportData = await adminService.generateStudentsReport('2025-09-01', '2025-09-30');
```