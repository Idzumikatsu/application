# Мониторинг и деплой админ-панели CRM системы

## Обзор

Этот документ описывает полную систему мониторинга и деплоя админ-панели CRM системы, включая все компоненты, процессы и настройки.

## Компоненты системы

### 1. Мониторинг

#### Prometheus
- **Назначение**: Сбор метрик с сервисов
- **Конфигурация**: `/opt/application/monitoring/prometheus.yml`
- **Правила оповещения**: `/opt/application/monitoring/admin-panel-rules.yml`
- **URL**: https://prometheus.crm-synergy.ru

#### Grafana
- **Назначение**: Визуализация метрик и дашборды
- **Дашборд**: `/opt/application/monitoring/admin-panel-dashboard.json`
- **Источники данных**: `/opt/application/monitoring/grafana-datasources.yml`
- **URL**: https://grafana.crm-synergy.ru

#### Loki и Promtail
- **Назначение**: Централизованное логирование
- **Loki конфигурация**: `/opt/application/monitoring/loki.yml`
- **Promtail конфигурация**: `/opt/application/monitoring/promtail.yml`
- **Loki URL**: https://loki.crm-synergy.ru

### 2. Деплой

#### Скрипты
- **Полный деплой**: `/opt/application/deploy.sh`
- **Быстрый деплой**: `/opt/application/quick-deploy.sh`

#### CI/CD
- **GitHub Actions**: `.github/workflows/ci-cd.yml`

#### Резервное копирование
- **Создание бэкапа**: `/opt/application/scripts/admin-panel-backup.sh`
- **Восстановление**: `/opt/application/scripts/admin-panel-restore.sh`
- **Cron jobs**: `/opt/application/scripts/cron/admin-panel-backup-cron`

## Метрики

### Бэкенд (Spring Boot)
- Время отклика HTTP запросов
- Использование памяти и CPU
- Количество потоков
- Размер пула соединений к БД

### Фронтенд (React)
- Время загрузки страниц
- Количество ошибок JavaScript
- Время выполнения API запросов

### База данных (PostgreSQL)
- Количество активных соединений
- Время выполнения запросов
- Размер базы данных

### Traefik
- Количество запросов
- Время отклика
- Коды ответов

## Алерты

### Критические
- Сервисы недоступны
- Высокий процент ошибок

### Предупреждения
- Высокое время отклика
- Высокое использование ресурсов

## Логирование

### Централизованное логирование
Все логи собираются и хранятся централизованно:
- Бэкенд приложение
- Фронтенд приложение
- База данных
- Traefik

## Процессы

### Деплой
1. Остановка всех контейнеров
2. Получение последних изменений из репозитория
3. Пересборка Docker образов
4. Запуск всех сервисов
5. Проверка работоспособности

### Резервное копирование
- Ежедневно в 02:00
- Еженедельно в 01:00 (воскресенье)
- Хранение бэкапов в течение 7 дней

### Масштабирование
- Горизонтальное масштабирование сервисов
- Автоматическая балансировка нагрузки через Traefik

## Документация

### Мониторинг
- [Настройка мониторинга](docs/monitoring/monitoring-setup.md)
- [README мониторинга](monitoring/README.md)

### Деплой
- [Руководство по деплою](docs/monitoring/deployment-guide.md)

## Безопасность

### Аутентификация
- Grafana: admin/admin (по умолчанию, необходимо изменить)
- Prometheus: без аутентификации
- Loki: без аутентификации

### Рекомендации
- Изменить пароль Grafana
- Настроить SSL для всех сервисов
- Ограничить доступ к системам мониторинга

## Устранение неполадок

### Сервисы мониторинга не работают
1. Проверить логи контейнеров
2. Убедиться, что все директории созданы
3. Проверить конфигурационные файлы

### Нет данных в дашбордах
1. Проверить статус целей в Prometheus
2. Проверить конфигурацию источников данных Grafana
3. Убедиться, что сервисы доступны

### Проблемы с логированием
1. Проверить работу Promtail
2. Убедиться, что пути к логам указаны правильно
3. Проверить конфигурацию Loki

## Обслуживание

### Регулярные задачи
- Мониторинг алертов
- Проверка состояния сервисов
- Обновление документации

### При обновлении системы
1. Обновить код из репозитория
2. Проверить конфигурационные файлы
3. Выполнить деплой
4. Проверить работоспособность

## Контакты

При возникновении проблем с системой мониторинга и деплоя обращайтесь к системному администратору.