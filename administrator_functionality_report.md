# Подробный отчет о бизнес-требованиях к функционалу администратора

## Введение

В рамках разработки CRM-системы для онлайн-школы английского языка, роль администратора представляет собой высший уровень доступа в системе. Администратор отвечает за управление всей системой, включая пользователей, настройки и мониторинг работы всей платформы.

## Бизнес-требования к функционалу администратора

### 1. Управление пользователями

#### 1.1. Управление менеджерами
Администратор должен иметь полный контроль над учетными записями менеджеров:
- Создание новых менеджеров в системе
- Просмотр списка всех менеджеров
- Редактирование информации о менеджерах (персональные данные, статус активности)
- Удаление учетных записей менеджеров
- Сброс паролей менеджеров
- Отправка приветственных писем с учетными данными

#### 1.2. Управление преподавателями
Администратор также управляет учетными записями преподавателей:
- Создание новых преподавателей в системе
- Просмотр списка всех преподавателей
- Редактирование информации о преподавателях (персональные данные, специализация, статус активности)
- Удаление учетных записей преподавателей
- Сброс паролей преподавателей
- Отправка приветственных писем с учетными данными

#### 1.3. Управление студентами
Администратор имеет полный доступ ко всем студентам системы:
- Просмотр всех студентов в системе
- Назначение/отмена назначения преподавателей студентам
- Просмотр всех пакетов уроков студентов
- Возможность редактирования информации о студентах при необходимости

### 2. Системные функции

#### 2.1. Доступ к системной информации
- Просмотр всех информационных панелей и отчетов
- Доступ к метрикам системы (активные студенты, активные преподаватели, количество уроков)
- Просмотр всех запланированных уроков в системе
- Возможность переопределения любого статуса урока при необходимости

#### 2.2. Настройка системных параметров
- Конфигурация общих параметров системы
- Управление настройками уведомлений
- Контроль параметров безопасности

#### 2.3. Безопасность и аудит
- Просмотр логов безопасности
- Мониторинг попыток аутентификации
- Контроль доступа пользователей к данным
- Аудит действий пользователей в системе

### 3. Отчетность и экспорт данных

#### 3.1. Информационные панели
- Доступ к ключевым метрикам системы
- Просмотр статистики по активным пользователям
- Мониторинг загрузки преподавателей
- Отслеживание использования пакетов уроков

#### 3.2. Экспорт данных
- Экспорт списка студентов в формате XLSX
- Экспорт списка преподавателей в формате XLSX
- Экспорт истории уроков в формате XLSX

## Требуемые функции приложения для администратора

### 1. Аутентификация и авторизация

#### 1.1. Вход в систему
- Защищенная форма входа с проверкой учетных данных
- Поддержка JWT-токенов для аутентификации
- Возможность многофакторной аутентификации (MFA) для повышенной безопасности
- Блокировка учетной записи после нескольких неудачных попыток входа

#### 1.2. Управление сессией
- Автоматический выход при истечении срока действия токена
- Возможность принудительного завершения сессий
- Безопасное хранение токенов аутентификации

### 2. Интерфейс управления пользователями

#### 2.1. Панель управления менеджерами
- Список всех менеджеров с возможностью фильтрации и поиска
- Форма создания нового менеджера с валидацией данных
- Детальное представление информации о менеджере
- Функции редактирования, удаления и сброса пароля
- Кнопка отправки приветственного письма повторно

#### 2.2. Панель управления преподавателями
- Список всех преподавателей с фильтрами по специализации и статусу
- Форма создания нового преподавателя
- Детальное представление информации о преподавателе
- Функции редактирования, удаления и сброса пароля
- Кнопка отправки приветственного письма повторно

#### 2.3. Панель управления студентами
- Список всех студентов с возможностью поиска
- Детальное представление информации о студенте
- Возможность назначения/отмены назначения преподавателя
- Просмотр пакетов уроков студента

### 3. Системная информационная панель

#### 3.1. Ключевые метрики
- Отображение общего количества активных студентов
- Отображение общего количества активных преподавателей
- Отображение количества уроков, запланированных на сегодня
- Отображение количества уроков, проведенных за текущую неделю/месяц

#### 3.2. Списки с уведомлениями
- Список студентов с заканчивающимися пакетами занятий (≤ 3 урока)
- Список преподавателей с низкой загрузкой
- Список студентов без назначенного преподавателя

### 4. API-эндпоинты для администратора

#### 4.1. Управление менеджерами
```
GET /api/admin/managers - Получение списка всех менеджеров
POST /api/admin/managers - Создание нового менеджера
PUT /api/admin/managers/{id} - Обновление информации о менеджере
DELETE /api/admin/managers/{id} - Удаление менеджера
POST /api/admin/managers/{id}/reset-password - Сброс пароля менеджера
```

#### 4.2. Управление преподавателями
```
GET /api/admin/teachers - Получение списка всех преподавателей
POST /api/admin/teachers - Создание нового преподавателя
PUT /api/admin/teachers/{id} - Обновление информации о преподавателе
DELETE /api/admin/teachers/{id} - Удаление преподавателя
POST /api/admin/teachers/{id}/reset-password - Сброс пароля преподавателя
```

#### 4.3. Системные функции
```
GET /api/dashboard/stats - Получение статистики системы
GET /api/dashboard/students-ending-soon - Получение списка студентов с заканчивающимися пакетами
GET /api/reports/students - Экспорт данных о студентах
GET /api/reports/teachers - Экспорт данных о преподавателях
GET /api/reports/lessons - Экспорт данных об уроках
```

### 5. Безопасность и контроль доступа

#### 5.1. Контроль доступа на основе ролей
- Все API-эндпоинты защищены аннотациями @PreAuthorize
- Проверка ролей пользователя при каждом запросе
- Контроль доступа к данным на уровне сервисов

#### 5.2. Аудит действий
- Логирование всех действий администратора
- Отслеживание создания, изменения и удаления пользователей
- Мониторинг доступа к конфиденциальной информации

#### 5.3. Защита данных
- Шифрование данных в передаче (TLS 1.2+)
- Хеширование паролей с использованием bcrypt
- Безопасное хранение конфиденциальной информации

## Технические требования

### 1. База данных
Все данные администратора хранятся в таблице `users` с ролью `ADMIN`. Структура таблицы:
```sql
users (
    id BIGSERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    phone VARCHAR(20),
    telegram_username VARCHAR(100),
    telegram_chat_id BIGINT,
    role VARCHAR(20) NOT NULL, -- ADMIN, MANAGER, TEACHER
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
```

### 2. Интеграция с уведомлениями
- Отправка приветственных писем при создании учетных записей
- Логирование всех отправленных уведомлений
- Возможность повторной отправки уведомлений

### 3. Масштабируемость
- Модульная архитектура для легкого расширения функционала
- Возможность разделения на микросервисы в будущем
- Поддержка горизонтального масштабирования

## Заключение

Функционал администратора в CRM-системе онлайн-школы английского языка представляет собой комплексный набор инструментов для управления всей системой. Администратор обладает полным доступом ко всем данным и функциям системы, что позволяет эффективно управлять пользователями, отслеживать работу платформы и обеспечивать её безопасность. Реализация всех перечисленных функций позволит администратору эффективно управлять системой и поддерживать её стабильную работу.


  Подробный отчет о бизнес-требованиях к функционалу администратора

  Ключевые бизнес-требования

  Администратор в системе обладает высшим уровнем доступа и выполняет следующие основные функции:

   1. Управление пользователями:
      - Создание, редактирование, удаление менеджеров
      - Создание, редактирование, удаление преподавателей
      - Полный доступ ко всем студентам системы
      - Сброс паролей для всех пользователей
      - Отправка приветственных писем с учетными данными

   2. Системные функции:
      - Доступ ко всем информационным панелям и отчетам
      - Настройка системных параметров
      - Мониторинг всех запланированных уроков
      - Переопределение статусов уроков при необходимости

   3. Отчетность и экспорт данных:
      - Просмотр ключевых метрик системы
      - Экспорт данных о студентах, преподавателях и уроках в формате XLSX

  Требуемые функции приложения

  Аутентификация и безопасность
   - Защищенная форма входа с JWT-токенами
   - Поддержка многофакторной аутентификации
   - Контроль сессий и автоматический выход при истечении срока действия

  Интерфейс управления
   - Панели управления для менеджеров и преподавателей с функциями CRUD
   - Системная информационная панель с ключевыми метриками
   - Возможность фильтрации и поиска пользователей

  API-эндпоинты
   - Эндпоинты для управления менеджерами и преподавателями
   - Эндпоинты для получения системной статистики
   - Эндпоинты для экспорта данных

  Безопасность
   - Контроль доступа на основе ролей
   - Аудит действий администратора
   - Шифрование данных и защита конфиденциальной информации

    │    ◐  Фаза 1: Расширение управления студентами администратором                                                        │
 │    ●  Задача 1.1: Добавить API эндпоинты в AdminController для получения списка всех студентов с фильтрацией          │
 │    ○  Задача 1.2: Добавить API эндпоинты в AdminController для назначения/отмены назначения преподавателей студентам  │
 │    ○  Задача 1.3: Добавить API эндпоинты в AdminController для просмотра пакетов уроков студентов                     │
 │    ○  Задача 1.4: Расширить StudentService для поддержки операций администратора                                      │
 │    ○  Задача 1.5: Расширить StudentController для поддержки дополнительных операций администратора                    │
 │    ○  Фаза 2: Расширенные системные функции                                                                           │
 │    ○  Задача 2.1: Создать модель SystemSettings и репозиторий SystemSettingsRepository                                │
 │    ○  Задача 2.2: Создать сервис SystemSettingsService                                                                │
 │    ○  Задача 2.3: Расширить DashboardService для добавления расширенных метрик для администратора                     │
 │    ○  Задача 2.4: Расширить DashboardService для добавления мониторинга системных параметров                          │
 │    ○  Задача 2.5: Расширить ReportService для добавления расширенных отчетов для администратора                       │
 │    ○  Задача 2.6: Расширить ReportService для поддержки массового экспорта данных                                     │
 │    ○  Фаза 3: Расширенная система уведомлений                                                                         │
 │    ○  Задача 3.1: Расширить NotificationService для поддержки широковещательной рассылки                              │
 │    ○  Задача 3.2: Расширить NotificationService для добавления уведомлений о техническом обслуживании                 │
 │    ○  Задача 3.3: Расширить EmailService для поддержки массовой отправки писем администратором                        │
 │    ○  Задача 3.4: Расширить EmailService для добавления шаблонов для системных уведомлений                            │
 │    ○  Задача 3.5: Добавить NotificationBroadcastService для управления широковещательной рассылкой                    │
 │    ○  Задача 3.6: Добавить NotificationBroadcastService для фильтрации получателей по критериям                       │
 │    ○  Фаза 5: Тестирование и оптимизация                                                                              │
 │    ○  Задача 5.1: Создать unit-тесты для новых сервисов                                                               │
 │    ○  Задача 5.2: Создать интеграционные тесты для новых API эндпоинтов                                               │
 │    ○  Задача 5.3: Провести нагрузочное тестирование                                                                   │
 │    ○  Задача 5.4: Оптимизировать производительность    