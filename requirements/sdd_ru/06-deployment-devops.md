# Архитектура развертывания и настройка DevOps

## Архитектура развертывания

### Продуктовая среда
- **Балансировщик нагрузки**: Nginx в качестве обратного прокси и балансировщика нагрузки
- **Сервер приложений**: Несколько экземпляров приложения Spring Boot
- **Сервер базы данных**: PostgreSQL с репликацией для высокой доступности
- **Сервер кэша**: Redis для хранения сессий и кэширования
- **Сервер бота**: Выделенный сервер Node.js для Telegram-бота
- **Хранилище файлов**: Локальное хранилище для экспортированных отчетов
- **Мониторинг**: Базовое логирование с ротацией логов

### Стейджинговая среда
- Аналогичная настройка продукции, но с меньшим количеством экземпляров
- Используется для тестирования перед развертыванием в продуктиве

### Среда разработки
- Единый экземпляр всех сервисов
- Локальная настройка на сервере разработки
- База данных разработки с образцовыми данными

## Настройка DevOps

### Конвейер CI/CD
1. **Контроль версий**: Репозиторий GitHub со стратегией ветвления
   - Ветка `master` для готового к работе кода продукта

2. **Непрерывная интеграция**:
   - GitHub Actions для автоматизированных сборок
   - Запуск тестов при каждом push в ветку
   - Проверки качества кода SonarQube
   - Автоматизированные сканирования безопасности

3. **Непрерывное развертывание**:
   - Автоматизированное развертывание в стейджинг при push в `master`
   - Требуется ручное одобрение для развертывания в продуктиве
   - Стратегия сине-зеленого развертывания для минимизации времени простоя

### Управление сервисами
- **Менеджер процессов**: PM2 для управления процессами Node.js (Telegram-бот)
- **Системные службы**: systemd для управления службами Spring Boot и других компонентов
- **Мониторинг процессов**: Встроенный мониторинг состояния служб

### Инфраструктура как код
- **Управление конфигурацией**: Ansible скрипты для настройки сервера
- **Инфраструктура**: Ручная настройка серверов (без облачных провайдеров)
- **Конфигурация среды**: Файлы конфигурации для конкретных сред

### Мониторинг и логирование
- **Логи приложений**: Структурированное логирование с уровнями логов
- **Системный мониторинг**: Базовые метрики сервера (ЦП, память, диск)
- **Проверки работоспособности**: Конечная точка для проверки работоспособности сервиса
- **Отслеживание ошибок**: Анализ логов приложений и системных журналов

### Резервное копирование и восстановление
- **Резервные копии базы данных**: Автоматизированные ежедневные резервные копии с политикой хранения
- **Резервные копии конфигурации**: Файлы конфигурации с контролем версий
- **Восстановление после катастроф**: Задокументированные процедуры восстановления